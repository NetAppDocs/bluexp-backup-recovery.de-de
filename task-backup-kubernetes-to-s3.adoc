---
sidebar: sidebar 
permalink: task-backup-kubernetes-to-s3.html 
keywords: backing up, back up, backup, back up kubernetes volumes, persistent volumes, PV, persistence volume claim, PVC, aws, aws s3, amazon s3, s3 bucket, back up volumes, cloud backup, eks, kubernetes 
summary: Führen Sie einige Schritte aus, um die Datensicherung von Daten der persistenten Volumes auf EKS Kubernetes-Clustern in Amazon S3 Storage zu starten. 
---
= Sichern Sie persistente Kubernetes-Volume-Daten in Amazon S3
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Führen Sie einige Schritte aus, um die Datensicherung von Daten der persistenten Volumes auf EKS Kubernetes-Clustern in Amazon S3 Storage zu starten.



== Schnellstart

Führen Sie diese Schritte schnell durch, oder scrollen Sie nach unten zu den verbleibenden Abschnitten, um ausführliche Informationen zu erhalten.

.<span class=„image“><img src="https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png"[] alt=„One“></span> Voraussetzungen prüfen
* Sie haben den Kubernetes Cluster als BlueXP-Arbeitsumgebung erkannt.
+
** Trident muss auf dem Cluster installiert sein, und die Trident Version muss mindestens 21.1 sein.
** Alle PVCs, die verwendet werden sollen, um persistente Volumes zu erstellen, die Sie sichern möchten, müssen „Snapshot Policy“ auf „Standard“ gesetzt sein.
** Der Cluster muss für seinen Back-End Storage Cloud Volumes ONTAP on AWS verwenden.
** Das Cloud Volumes ONTAP System muss ONTAP 9.7P5 oder höher ausführen.


* Sie verfügen über ein gültiges Cloud-Provider-Abonnement für den Speicherplatz, auf dem sich Ihre Backups befinden.
* Sie haben sich für das angemeldet https://aws.amazon.com/marketplace/pp/prodview-oorxakq6lq7m4?sr=0-8&ref_=beagle&applicationId=AWSMPContessa["BlueXP Marketplace Backup-Angebot"], An https://aws.amazon.com/marketplace/pp/B086PDWSS8["AWS Jahresvertrag"], Oder Sie haben gekauft link:task-licensing-cloud-backup.html#use-a-cloud-backup-byol-license["Und aktiviert"] Eine Cloud Backup BYOL-Lizenz von NetApp
* Die IAM-Rolle, die den BlueXP Connector mit Berechtigungen bereitstellt, umfasst die neuesten S3-Berechtigungen https://docs.netapp.com/us-en/cloud-manager-setup-admin/reference-permissions-aws.html["BlueXP-Richtlinie"^].


[role="quick-margin-para"]
Wählen Sie die Arbeitsumgebung aus, und klicken Sie auf *Aktivieren* neben dem Backup & Restore-Dienst im rechten Fenster, und folgen Sie dann dem Setup-Assistenten.

[role="quick-margin-para"]
image:screenshot_backup_cvo_enable.png["Ein Screenshot, der die Schaltfläche Cloud Backup Enable zeigt, die nach der Auswahl einer Arbeitsumgebung verfügbar ist."]

[role="quick-margin-para"]
Die Standardrichtlinie sichert Volumes täglich und speichert die letzten 30 Backup-Kopien jedes Volumes. Wechseln Sie zu stündlichen, täglichen, wöchentlichen oder monatlichen Backups oder wählen Sie eine der systemdefinierten Richtlinien aus, die mehr Optionen bieten. Sie können auch die Anzahl der zu behaltenden Backup-Kopien ändern.

[role="quick-margin-para"]
image:screenshot_backup_policy_k8s_aws.png["Ein Screenshot mit den Cloud Backup-Einstellungen, in dem Sie Ihren Backup-Zeitplan und den Aufbewahrungszeitraum auswählen können."]

[role="quick-margin-para"]
Legen Sie fest, welche Volumes Sie in der Seite Volumes auswählen sichern möchten. Ein S3-Bucket wird automatisch im selben AWS-Konto und in derselben Region wie das Cloud Volumes ONTAP System erstellt und die Backup-Dateien dort gespeichert.



== Anforderungen

Lesen Sie die folgenden Anforderungen, um sicherzustellen, dass Sie über eine unterstützte Konfiguration verfügen, bevor Sie mit dem Backup persistenter Kubernetes-Volumes in S3 beginnen.

Die folgende Abbildung zeigt die einzelnen Komponenten und die Verbindungen, die zwischen den Komponenten vorbereitet werden müssen:

image:diagram_cloud_backup_k8s_cvo_aws.png["Eine Grafik zeigt, wie Cloud Backup mit den Volumes der Quellsysteme und dem Ziel-Storage kommuniziert, auf dem sich die Backup-Dateien befinden."]

Der VPC Endpunkt ist optional.

Kubernetes-Cluster-Anforderungen::
+
--
* Sie haben den Kubernetes Cluster als BlueXP-Arbeitsumgebung erkannt. https://docs.netapp.com/us-en/cloud-manager-kubernetes/task/task-kubernetes-discover-aws.html["Erkennung des Kubernetes-Clusters"^].
* Trident muss auf dem Cluster installiert werden, und die Trident Version muss mindestens 21.1 sein. Siehe https://docs.netapp.com/us-en/cloud-manager-kubernetes/task/task-k8s-manage-trident.html["Anleitung zur Installation von Trident"^] Oder https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-trident.html["So aktualisieren Sie die Trident Version"^].
* Der Cluster muss für seinen Back-End Storage Cloud Volumes ONTAP on AWS verwenden.
* Das Cloud Volumes ONTAP System muss sich in derselben AWS Region wie der Kubernetes-Cluster befinden. Es muss ONTAP 9.7P5 oder höher ausgeführt werden (ONTAP 9.8P11 und höher wird empfohlen).
+
Beachten Sie, dass Kubernetes-Cluster an On-Premises-Standorten nicht unterstützt werden. Es werden nur Kubernetes-Cluster in Cloud-Implementierungen unterstützt, die Cloud Volumes ONTAP Systeme nutzen.

* Für alle Persistent Volume Claim-Objekte, die zum Erstellen der persistenten Volumes verwendet werden sollen, die Sie sichern möchten, muss „Snapshot Policy“ auf „Standard“ gesetzt sein.
+
Sie können dies für einzelne VES tun, indem Sie hinzufügen `snapshotPolicy` Unter Anmerkungen:

+
[source, json]
----
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: full
  annotations:
    trident.netapp.io/snapshotPolicy: "default"
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1000Mi
  storageClassName: silver
----
+
Sie können dies für alle VES, die mit einem bestimmten Back-End-Speicher verknüpft sind, tun, indem Sie die hinzufügen `snapshotPolicy` Feld unter den Standardeinstellungen im `backend.json` Datei:

+
[source, json]
----
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-nas-advanced
spec:
  version: 1
  storageDriverName: ontap-nas
  managementLIF: 10.0.0.1
  dataLIF: 10.0.0.2
  backendName: tbc-ontap-nas-advanced
  svm: trident_svm
  credentials:
    name: backend-tbc-ontap-nas-advanced-secret
  limitAggregateUsage: 80%
  limitVolumeSize: 50Gi
  nfsMountOptions: nfsvers=4
  defaults:
    spaceReserve: volume
    exportPolicy: myk8scluster
    snapshotPolicy: default
    snapshotReserve: '10'
  deletionPolicy: retain
----


--
Lizenzanforderungen:: Für Cloud Backup PAYGO-Lizenzen ist im AWS Marketplace ein Abonnement verfügbar, das die Implementierung von Cloud Volumes ONTAP und Cloud Backup ermöglicht. Sie müssen https://aws.amazon.com/marketplace/pp/prodview-oorxakq6lq7m4?sr=0-8&ref_=beagle&applicationId=AWSMPContessa["Melden Sie sich für dieses BlueXP-Abonnement an"^] Vor Aktivierung von Cloud Backup: Die Abrechnung für Cloud Backup erfolgt über dieses Abonnement.
+
--
Bei einem Jahresvertrag, mit dem Sie sowohl Cloud Volumes ONTAP Daten als auch ONTAP Daten vor Ort sichern können, müssen Sie den Abonnement von abonnieren https://aws.amazon.com/marketplace/pp/B086PDWSS8["AWS Marketplace Seite"^] Und dann https://docs.netapp.com/us-en/cloud-manager-setup-admin/task-adding-aws-accounts.html["Verbinden Sie das Abonnement mit Ihren AWS Zugangsdaten"^].

Für einen Jahresvertrag, mit dem Sie Cloud Volumes ONTAP und Cloud Backup bündeln können, müssen Sie bei der Erstellung einer Cloud Volumes ONTAP Arbeitsumgebung den Jahresvertrag abschließen. Mit dieser Option können Sie Backups von Daten vor Ort nicht erstellen.

Für die BYOL-Lizenzierung von Cloud Backup benötigen Sie die Seriennummer von NetApp, mit der Sie den Service für die Dauer und die Kapazität der Lizenz nutzen können. link:task-licensing-cloud-backup.html#use-a-cloud-backup-byol-license["Erfahren Sie, wie Sie Ihre BYOL-Lizenzen managen"].

Zudem benötigen Sie ein AWS-Konto für den Speicherplatz, auf dem sich Ihre Backups befinden.

--
Unterstützte AWS-Regionen:: Cloud Backup wird in allen AWS Regionen unterstützt https://cloud.netapp.com/cloud-volumes-global-regions["Wobei Cloud Volumes ONTAP unterstützt wird"^].
AWS Backup Berechtigungen erforderlich:: Die IAM-Rolle, die BlueXP Berechtigungen bereitstellt, muss die neuesten S3-Berechtigungen enthalten https://mysupport.netapp.com/site/info/cloud-manager-policies["BlueXP-Richtlinie"^].
+
--
Im Folgenden sind die spezifischen S3 Berechtigungen aus der Richtlinie aufgeführt:

[source, json]
----
{
            "Sid": "backupPolicy",
            "Effect": "Allow",
            "Action": [
                "s3:DeleteBucket",
                "s3:GetLifecycleConfiguration",
                "s3:PutLifecycleConfiguration",
                "s3:PutBucketTagging",
                "s3:ListBucketVersions",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:ListBucket",
                "s3:ListAllMyBuckets",
                "s3:GetBucketTagging",
                "s3:GetBucketLocation",
                "s3:GetBucketPolicyStatus",
                "s3:GetBucketPublicAccessBlock",
                "s3:GetBucketAcl",
                "s3:GetBucketPolicy",
                "s3:PutBucketPublicAccessBlock"
            ],
            "Resource": [
                "arn:aws:s3:::netapp-backup-*"
            ]
        },
----
--




== Unterstützung Von Cloud Backup

Cloud-Backup kann jederzeit direkt aus der Kubernetes-Arbeitsumgebung aktiviert werden.

.Schritte
. Wählen Sie die Arbeitsumgebung aus, und klicken Sie neben dem Backup & Restore Service im rechten Fenster auf *Aktivieren.
+
Wenn das Amazon S3 Ziel für Ihre Backups als Arbeitsumgebung auf dem Canvas existiert, können Sie das Kubernetes-Cluster in die Amazon S3-Arbeitsumgebung ziehen, um den Setup-Assistenten zu starten.

+
image:screenshot_backup_cvo_enable.png["Ein Screenshot, der die Schaltfläche Cloud Backup Settings zeigt, die nach der Auswahl einer Arbeitsumgebung verfügbar ist."]

. Geben Sie die Backup Policy Details ein und klicken Sie auf *Weiter*.
+
Sie können den Backup-Zeitplan festlegen und die Anzahl der zu behaltenden Backups auswählen.

+
image:screenshot_backup_policy_k8s_aws.png["Ein Screenshot, der die Cloud Backup Einstellungen zeigt, in denen Sie Ihren Zeitplan und Ihre Backup-Aufbewahrung auswählen können."]

. Wählen Sie die persistenten Volumes aus, die Sie sichern möchten.
+
** Um alle Volumes zu sichern, aktivieren Sie das Kontrollkästchen in der Titelzeile (image:button_backup_all_volumes.png[""]).
** Um einzelne Volumes zu sichern, aktivieren Sie das Kontrollkästchen für jedes Volume (image:button_backup_1_volume.png[""]).
+
image:screenshot_backup_select_volumes_k8s.png["Ein Screenshot, wie Sie die persistenten Volumes auswählen, die gesichert werden."]



. Wenn Sie möchten, dass alle aktuellen und zukünftigen Volumes Backups aktiviert sind, lassen Sie einfach das Kontrollkästchen „zukünftige Volumes automatisch sichern…​“ aktiviert. Wenn Sie diese Einstellung deaktivieren, müssen Sie manuell Backups für zukünftige Volumes aktivieren.
. Klicken Sie auf *Activate Backup* und Cloud Backup beginnt die Erstellung der ersten Backups jedes ausgewählten Volumes.


Ein S3-Bucket wird automatisch im selben AWS-Konto und in derselben Region wie das Cloud Volumes ONTAP System erstellt und die Backup-Dateien dort gespeichert.

Das Kubernetes Dashboard wird angezeigt, damit Sie den Status der Backups überwachen können.

Das können Sie link:task-manage-backups-kubernetes.html["Starten und Stoppen von Backups für Volumes oder Ändern des Backup-Zeitplans"^]. Das können Sie auch link:task-restore-backups-kubernetes.html#restoring-volumes-from-a-kubernetes-backup-file["Wiederherstellung vollständiger Volumes aus einer Backup-Datei"^] Für ein neues Volume auf demselben oder einem anderen Kubernetes-Cluster in AWS (in derselben Region)
